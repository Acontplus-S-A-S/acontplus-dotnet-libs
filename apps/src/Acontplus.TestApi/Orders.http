### Test API - CQRS + Event Bus Demo
### Demonstrates Clean Architecture + DDD + Event-Driven Architecture using System.Threading.Channels
### For scalable, high-performance event processing with horizontal/vertical scaling

@baseUrl = https://localhost:7001
@orderId =

### ===========================================
### Create Order (CQRS Command)
### Triggers: OrderCreatedEvent -> OrderNotificationHandler, OrderAnalyticsHandler, OrderWorkflowHandler
### ===========================================

# @name createOrder
POST {{baseUrl}}/api/orders
Content-Type: application/json

{
  "customerName": "John Doe",
  "productName": "Premium Widget",
  "quantity": 5,
  "price": 99.99
}

### Store orderId from response
@orderId = {{createOrder.response.body.orderId}}

### ===========================================
### Get Order by ID (CQRS Query)
### ===========================================

GET {{baseUrl}}/api/orders/{{orderId}}

### ===========================================
### Get All Orders (CQRS Query)
### ===========================================

GET {{baseUrl}}/api/orders

### ===========================================
### Create Multiple Orders (Concurrent Load Test)
### Demonstrates high-throughput event publishing
### ===========================================

# @name createOrder2
POST {{baseUrl}}/api/orders
Content-Type: application/json

{
  "customerName": "Jane Smith",
  "productName": "Enterprise Solution",
  "quantity": 10,
  "price": 499.99
}

###

# @name createOrder3
POST {{baseUrl}}/api/orders
Content-Type: application/json

{
  "customerName": "Bob Johnson",
  "productName": "Starter Pack",
  "quantity": 3,
  "price": 29.99
}

###

# @name createOrder4
POST {{baseUrl}}/api/orders
Content-Type: application/json

{
  "customerName": "Alice Williams",
  "productName": "Professional License",
  "quantity": 1,
  "price": 199.00
}

###

# @name createOrder5
POST {{baseUrl}}/api/orders
Content-Type: application/json

{
  "customerName": "Charlie Brown",
  "productName": "Team Bundle",
  "quantity": 25,
  "price": 2499.99
}

### ===========================================
### Expected Log Output (Check Console)
### ===========================================

# When you create an order, you should see:
#
# 1. OrderNotificationHandler:
#    ðŸ“§ Sending email notification for Order {OrderId} - Customer: {CustomerName}, Total: ${TotalAmount}
#    âœ… Email notification sent successfully for Order {OrderId}
#
# 2. OrderAnalyticsHandler:
#    ðŸ“Š Recording analytics for Order {OrderId} - Product: {ProductName}, Amount: ${TotalAmount}
#    âœ… Analytics recorded for Order {OrderId}
#
# 3. OrderWorkflowHandler:
#    ðŸ”„ Auto-processing Order {OrderId} - triggering processing workflow
#    âœ… Order {OrderId} processed and event published
#    ðŸ“¦ Preparing shipment for Order {OrderId}
#    ðŸšš Order {OrderId} shipped successfully
#
# This demonstrates:
# - Multiple independent subscribers to the same event (OrderCreatedEvent)
# - Event-driven workflow orchestration (Created -> Processed -> Shipped)
# - Async event handlers running as BackgroundServices
# - High-performance channel-based event bus
# - Clean separation of commands, queries, and events (CQRS + Event Sourcing patterns)
